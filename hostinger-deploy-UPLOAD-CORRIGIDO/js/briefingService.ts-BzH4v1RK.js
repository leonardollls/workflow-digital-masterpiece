var e=Object.defineProperty,o=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(o,r,n)=>r in o?e(o,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[r]=n,s=(e,o)=>{for(var r in o||(o={}))t.call(o,r)&&a(e,r,o[r]);if(n)for(var r of n(o))i.call(o,r)&&a(e,r,o[r]);return e},l=(e,n)=>o(e,r(n)),c=(e,o,r)=>new Promise(((n,t)=>{var i=e=>{try{s(r.next(e))}catch(o){t(o)}},a=e=>{try{s(r.throw(e))}catch(o){t(o)}},s=e=>e.done?n(e.value):Promise.resolve(e.value).then(i,a);s((r=r.apply(e,o)).next())}));import{d,s as u,e as f,g}from"../assets/index-B5nMKk-1.js";import"./chunk-BFAGzeFF.js";import"./chunk-COwh6yNZ.js";import"./chunk-BU7_rkh7.js";import"./chunk-CTAWNzGL.js";import"./chunk-D1HE5xNQ.js";const m=(e,o,r)=>c(void 0,null,(function*(){if(!e||0===e.length)return[];const n=Array.from(e).map(((e,n)=>c(void 0,null,(function*(){const t=Date.now(),i=e.name.replace(/[^a-zA-Z0-9.-]/g,"_").replace(/_{2,}/g,"_").toLowerCase(),a=`${r}/${t}_${n}_${i}`;try{if(e.size>52428800)throw new Error(`Arquivo muito grande (${(e.size/1024/1024).toFixed(2)}MB). Máximo: 50MB`);if(0===e.size)throw new Error("Arquivo vazio ou corrompido");["image/jpeg","image/jpg","image/png","image/webp","image/svg+xml","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation"].includes(e.type);let r=!1,n=null;for(let t=1;t<=3;t++)try{yield f(e,o,a);const n=g(o,a);return r=!0,n}catch(s){n=s,t<3&&(yield new Promise((e=>setTimeout(e,1e3*t))))}if(!r)throw n||new Error("Upload falhou após 3 tentativas")}catch(l){let o="Erro desconhecido";throw l instanceof Error&&(o=l.message.includes("413")?"Arquivo muito grande":l.message.includes("403")?"Sem permissão para upload":l.message.includes("400")?"Formato de arquivo inválido":l.message.includes("network")||l.message.includes("fetch")?"Erro de conexão":l.message),new Error(`${e.name}: ${o}`)}}))));try{return yield Promise.all(n)}catch(t){throw new Error(`Erro no upload: ${t instanceof Error?t.message:"Erro desconhecido"}`)}})),p=e=>c(void 0,null,(function*(){try{let r=[],n=[],t=[];try{[r,n,t]=yield Promise.all([m(e.logoFiles,"briefing-files","logos"),m(e.visualFiles,"briefing-files","visual-references"),m(e.materialFiles,"briefing-files","materials")])}catch(o){o instanceof Error&&o.message;r=[],n=[],t=[]}const i={company_name:e.companyName||"Nome não informado",business_segment:e.businessSegment||"Segmento não informado",company_description:e.businessDescription||"Descrição não informada",target_audience:e.targetAudience||"Público-alvo não informado",competitive_advantage:e.competitiveDifferential||"Diferencial não informado",landing_page_goal:e.landingPageGoal||"Objetivo não informado",responsible_name:e.responsibleName||"Responsável não informado",product_name:e.productName||"Produto não informado",product_description:e.productDescription||"Descrição do produto não informada",main_benefits:e.mainBenefits||"Benefícios não informados",call_to_action:e.callToAction||"CTA não informado",lead_destination:e.leadDestination||"Destino não informado",has_logo:e.hasLogo||"Não informado",domain_info:e.desiredDomain||"Domínio não informado",deadline:e.deliveryDeadline||"Prazo não informado",main_competitors:e.mainCompetitors||null,customer_pain_points:e.customerPainPoints||null,success_stories:e.successStories||null,social_proof:e.socialProof||null,current_website:e.currentWebsite||null,number_of_offers:e.numberOfOffers||null,offer_details:e.offerDetails||null,pricing_model:e.pricingModel||null,price_range:null,guarantees:e.guarantees||null,target_results:e.targetResults||null,urgency_factors:e.urgencyFactors||null,objections:e.objections||null,landing_page_sections:e.landingPageSections||null,specific_requirements:e.specificRequirements||null,brand_colors:e.brandColors||null,brand_personality:e.brandPersonality||null,communication_tone:e.communicationTone||null,key_messages:e.keyMessages||null,logo_files:r.length>0?r:null,visual_references:e.visualReferences||null,visual_files:n.length>0?n:null,content_materials:e.contentMaterials||null,material_files:t.length>0?t:null,integrations:e.integrations||null,analytics_tracking:e.analytics||null,start_date:e.startDate||null,budget:e.budget||"Valor Acordado na Workana",additional_notes:e.additionalNotes||null};return yield((e,o=3,r=1e3)=>c(void 0,null,(function*(){for(let t=1;t<=o;t++)try{return yield e()}catch(n){if(t===o)throw n;yield new Promise((e=>setTimeout(e,r*t)))}throw new Error("Máximo de tentativas excedido")})))((()=>d(i)),3,2e3)}catch(r){throw Error,r}})),_=()=>c(void 0,null,(function*(){try{const{data:o,error:r}=yield u.from("client_briefings").select("*").order("created_at",{ascending:!1});if(r){return JSON.parse(localStorage.getItem("briefings")||"[]")}try{localStorage.setItem("briefings",JSON.stringify(o||[]))}catch(e){}return o||[]}catch(o){return JSON.parse(localStorage.getItem("briefings")||"[]")}})),y=(e,o)=>c(void 0,null,(function*(){try{const{data:n,error:t}=yield u.from("client_briefings").select("*").eq("id",e).single();if(t||!n){const r=JSON.parse(localStorage.getItem("briefings")||"[]"),n=r.findIndex((o=>o.id===e));if(-1===n)throw new Error(`Briefing com ID ${e} não encontrado`);return r[n]=l(s(s({},r[n]),o),{updated_at:(new Date).toISOString()}),localStorage.setItem("briefings",JSON.stringify(r)),r[n]}const{data:i,error:a}=yield u.from("client_briefings").update(l(s({},o),{updated_at:(new Date).toISOString()})).eq("id",e).select().single();if(a){const r=JSON.parse(localStorage.getItem("briefings")||"[]"),n=r.findIndex((o=>o.id===e));if(-1!==n)return r[n]=l(s(s({},r[n]),o),{updated_at:(new Date).toISOString()}),localStorage.setItem("briefings",JSON.stringify(r)),r[n];throw new Error("Falha ao atualizar briefing")}try{const o=JSON.parse(localStorage.getItem("briefings")||"[]"),r=o.findIndex((o=>o.id===e));-1!==r&&(o[r]=i,localStorage.setItem("briefings",JSON.stringify(o)))}catch(r){}return i}catch(n){throw n}})),b=e=>c(void 0,null,(function*(){try{const{data:r,error:n}=yield u.from("client_briefings").select("id, company_name").eq("id",e).single();if(n||!r){const o=JSON.parse(localStorage.getItem("briefings")||"[]"),r=o.length,n=o.filter((o=>o.id!==e));if(n.length===r)throw new Error(`Briefing com ID ${e} não encontrado para exclusão`);return void localStorage.setItem("briefings",JSON.stringify(n))}const{error:t,count:i}=yield u.from("client_briefings").delete({count:"exact"}).eq("id",e);if(t)throw new Error(`Erro do Supabase: ${t.message}`);if(0===i)throw new Error("Nenhum registro foi excluído");try{const o=JSON.parse(localStorage.getItem("briefings")||"[]").filter((o=>o.id!==e));localStorage.setItem("briefings",JSON.stringify(o))}catch(o){}}catch(r){try{const o=JSON.parse(localStorage.getItem("briefings")||"[]"),r=o.length,n=o.filter((o=>o.id!==e));if(n.length===r)throw new Error(`Briefing com ID ${e} não encontrado para exclusão`);localStorage.setItem("briefings",JSON.stringify(n))}catch(o){throw new Error("Falha ao excluir briefing")}}})),h=(e,o)=>c(void 0,null,(function*(){try{const r={proposal_value:o,proposal_date:(new Date).toISOString()};return yield y(e,r)}catch(r){throw r}}));export{h as addProposalValue,b as deleteBriefing,_ as getBriefings,p as submitBriefing,y as updateBriefing};
