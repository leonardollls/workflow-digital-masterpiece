var e=Object.defineProperty,n=Object.defineProperties,o=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,a=(n,o,i)=>o in n?e(n,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[o]=i,s=(e,n)=>{for(var o in n||(n={}))r.call(n,o)&&a(e,o,n[o]);if(i)for(var o of i(n))t.call(n,o)&&a(e,o,n[o]);return e},l=(e,i)=>n(e,o(i)),c=(e,n,o)=>new Promise(((i,r)=>{var t=e=>{try{s(o.next(e))}catch(n){r(n)}},a=e=>{try{s(o.throw(e))}catch(n){r(n)}},s=e=>e.done?i(e.value):Promise.resolve(e.value).then(t,a);s((o=o.apply(e,n)).next())}));import{d,s as u,e as m,g as f}from"../assets/index-D_c2fH01.js";import"./chunk-CL9ZPWFf.js";import"./chunk-COwh6yNZ.js";import"./chunk-BU7_rkh7.js";import"./chunk-OWSE0nMq.js";import"./chunk-D1HE5xNQ.js";const g=(e,n,o)=>c(void 0,null,(function*(){if(!e||0===e.length)return[];const i=Array.from(e).map(((e,i)=>c(void 0,null,(function*(){const r=Date.now(),t=e.name.replace(/[^a-zA-Z0-9.-]/g,"_").replace(/_{2,}/g,"_").toLowerCase(),a=`${o}/${r}_${i}_${t}`;try{if(e.size>52428800)throw new Error(`Arquivo muito grande (${(e.size/1024/1024).toFixed(2)}MB). Máximo: 50MB`);if(0===e.size)throw new Error("Arquivo vazio ou corrompido");["image/jpeg","image/jpg","image/png","image/webp","image/svg+xml","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation"].includes(e.type);let o=!1,i=null;for(let r=1;r<=3;r++)try{yield m(e,n,a);const i=f(n,a);return o=!0,i}catch(s){i=s,r<3&&(yield new Promise((e=>setTimeout(e,1e3*r))))}if(!o)throw i||new Error("Upload falhou após 3 tentativas")}catch(l){let n="Erro desconhecido";throw l instanceof Error&&(n=l.message.includes("413")?"Arquivo muito grande":l.message.includes("403")?"Sem permissão para upload":l.message.includes("400")?"Formato de arquivo inválido":l.message.includes("network")||l.message.includes("fetch")?"Erro de conexão":l.message),new Error(`${e.name}: ${n}`)}}))));try{return yield Promise.all(i)}catch(r){throw new Error(`Erro no upload: ${r instanceof Error?r.message:"Erro desconhecido"}`)}})),p=(e,n=3,o=1e3)=>c(void 0,null,(function*(){for(let r=1;r<=n;r++)try{return yield e()}catch(i){if(r===n)throw i;yield new Promise((e=>setTimeout(e,o*r)))}throw new Error("Máximo de tentativas excedido")})),_=e=>c(void 0,null,(function*(){try{let o=[],i=[],r=[];try{[o,i,r]=yield Promise.all([g(e.logoFiles,"briefing-files","logos"),g(e.visualFiles,"briefing-files","visual-references"),g(e.materialFiles,"briefing-files","materials")])}catch(n){n instanceof Error&&n.message;o=[],i=[],r=[]}const t={company_name:e.companyName||"Nome não informado",business_segment:e.businessSegment||"Segmento não informado",company_description:e.businessDescription||"Descrição não informada",target_audience:e.targetAudience||"Público-alvo não informado",competitive_advantage:e.competitiveDifferential||"Diferencial não informado",landing_page_goal:e.landingPageGoal||"Objetivo não informado",responsible_name:e.responsibleName||"Responsável não informado",product_name:e.productName||"Produto não informado",product_description:e.productDescription||"Descrição do produto não informada",main_benefits:e.mainBenefits||"Benefícios não informados",call_to_action:e.callToAction||"CTA não informado",lead_destination:e.leadDestination||"Destino não informado",has_logo:e.hasLogo||"Não informado",domain_info:e.desiredDomain||"Domínio não informado",deadline:"Valor Acordado na Workana",main_competitors:e.mainCompetitors||null,customer_pain_points:e.customerPainPoints||null,success_stories:e.successStories||null,social_proof:e.socialProof||null,current_website:e.currentWebsite||null,number_of_offers:e.numberOfOffers||null,offer_details:e.offerDetails||null,pricing_model:e.pricingModel||null,price_range:null,guarantees:e.guarantees||null,target_results:e.targetResults||null,urgency_factors:e.urgencyFactors||null,objections:e.objections||null,landing_page_sections:e.landingPageSections||null,specific_requirements:e.specificRequirements||null,brand_colors:e.brandColors||null,brand_personality:e.brandPersonality||null,communication_tone:e.communicationTone||null,key_messages:e.keyMessages||null,logo_files:o.length>0?o:null,visual_references:e.visualReferences||null,visual_files:i.length>0?i:null,content_materials:e.contentMaterials||null,material_files:r.length>0?r:null,integrations:e.integrations||null,analytics_tracking:e.analytics||null,start_date:e.startDate||null,budget:"Valor Acordado na Workana",additional_notes:e.additionalNotes||null};return yield p((()=>d(t)),3,2e3)}catch(o){throw Error,o}})),y=()=>c(void 0,null,(function*(){try{const{data:n,error:o}=yield u.from("client_briefings").select("*").order("created_at",{ascending:!1});if(o){return JSON.parse(localStorage.getItem("briefings")||"[]")}try{localStorage.setItem("briefings",JSON.stringify(n||[]))}catch(e){}return n||[]}catch(n){return JSON.parse(localStorage.getItem("briefings")||"[]")}})),b=(e,n)=>c(void 0,null,(function*(){try{const{data:i,error:r}=yield u.from("client_briefings").select("*").eq("id",e).single();if(r||!i){const o=JSON.parse(localStorage.getItem("briefings")||"[]"),i=o.findIndex((n=>n.id===e));if(-1===i)throw new Error(`Briefing com ID ${e} não encontrado`);return o[i]=l(s(s({},o[i]),n),{updated_at:(new Date).toISOString()}),localStorage.setItem("briefings",JSON.stringify(o)),o[i]}const{data:t,error:a}=yield u.from("client_briefings").update(l(s({},n),{updated_at:(new Date).toISOString()})).eq("id",e).select().single();if(a){const o=JSON.parse(localStorage.getItem("briefings")||"[]"),i=o.findIndex((n=>n.id===e));if(-1!==i)return o[i]=l(s(s({},o[i]),n),{updated_at:(new Date).toISOString()}),localStorage.setItem("briefings",JSON.stringify(o)),o[i];throw new Error("Falha ao atualizar briefing")}try{const n=JSON.parse(localStorage.getItem("briefings")||"[]"),o=n.findIndex((n=>n.id===e));-1!==o&&(n[o]=t,localStorage.setItem("briefings",JSON.stringify(n)))}catch(o){}return t}catch(i){throw i}})),h=e=>c(void 0,null,(function*(){try{const{data:o,error:i}=yield u.from("client_briefings").select("id, company_name").eq("id",e).single();if(i||!o){const n=JSON.parse(localStorage.getItem("briefings")||"[]"),o=n.length,i=n.filter((n=>n.id!==e));if(i.length===o)throw new Error(`Briefing com ID ${e} não encontrado para exclusão`);return void localStorage.setItem("briefings",JSON.stringify(i))}const{error:r,count:t}=yield u.from("client_briefings").delete({count:"exact"}).eq("id",e);if(r)throw new Error(`Erro do Supabase: ${r.message}`);if(0===t)throw new Error("Nenhum registro foi excluído");try{const n=JSON.parse(localStorage.getItem("briefings")||"[]").filter((n=>n.id!==e));localStorage.setItem("briefings",JSON.stringify(n))}catch(n){}}catch(o){try{const n=JSON.parse(localStorage.getItem("briefings")||"[]"),o=n.length,i=n.filter((n=>n.id!==e));if(i.length===o)throw new Error(`Briefing com ID ${e} não encontrado para exclusão`);localStorage.setItem("briefings",JSON.stringify(i))}catch(n){throw new Error("Falha ao excluir briefing")}}})),w=(e,n)=>c(void 0,null,(function*(){try{const o={proposal_value:n,proposal_date:(new Date).toISOString()};return yield b(e,o)}catch(o){throw o}})),v=e=>c(void 0,null,(function*(){try{let i=[],r=[],t=[];try{[i,r,t]=yield Promise.all([g(e.logoFiles,"briefing-files","institutional-logos"),g(e.visualFiles,"briefing-files","institutional-visual-references"),g(e.materialFiles,"briefing-files","institutional-materials")])}catch(n){i=[],r=[],t=[]}const a={company_name:e.companyName||"Nome não informado",business_segment:e.businessSegment||"Segmento não informado",company_description:e.companyDescription||"Descrição não informada",company_history:e.companyHistory||null,mission:e.mission||null,vision:e.vision||null,values:e.values||null,target_audience:e.targetAudience||"Público não informado",competitive_advantage:e.competitiveAdvantage||"Diferencial não informado",responsible_name:e.responsibleName||"Nome não informado",current_website:e.currentWebsite||null,website_goal:e.websiteGoal||"Objetivo não informado",website_type:e.websiteType||"Tipo não informado",main_functionalities:e.mainFunctionalities||"Funcionalidades não informadas",required_pages:e.requiredPages||"Páginas não informadas",navigation_structure:e.navigationStructure||null,content_hierarchy:e.contentHierarchy||null,services_products:e.servicesProducts||"Serviços não informados",team_info:e.teamInfo||null,certifications:e.certifications||null,awards_recognition:e.awardsRecognition||null,case_studies:e.caseStudies||null,testimonials:e.testimonials||null,brand_colors:e.brandColors||null,has_logo:e.hasLogo||"Não informado",logo_files:i.length>0?i:null,visual_references:e.visualReferences||null,visual_files:r.length>0?r:null,design_style:e.designStyle||null,main_competitors:e.mainCompetitors||null,customer_pain_points:e.customerPainPoints||null,customer_objections:e.customerObjections||null,communication_tone:e.communicationTone||null,key_messages:e.keyMessages||null,specific_requirements:e.specificRequirements||null,content_materials:e.contentMaterials||null,material_files:t.length>0?t:null,contact_forms:e.contactForms||null,integrations:e.integrations||null,seo_requirements:e.seoRequirements||null,analytics_tracking:e.analytics||null,domain_info:e.desiredDomain||"Domínio não informado",hosting_preferences:e.hostingPreferences||null,deadline:e.deliveryDeadline||"Valor Acordado na Workana",budget:e.budget||"Valor Acordado na Workana",start_date:e.startDate||null,additional_notes:e.additionalNotes||null},s=yield p((()=>c(void 0,null,(function*(){const{data:e,error:n}=yield u.from("institutional_briefings").insert([a]).select().single();if(n)throw new Error(`Erro do banco: ${n.message}`);if(!e)throw new Error("Nenhum dado retornado do banco");return e}))),3,1e3);try{yield S(s)}catch(o){}return s}catch(i){let e="Erro desconhecido";throw i instanceof Error&&(e=i.message.includes("duplicate key")?"Briefing duplicado detectado":i.message.includes("connection")?"Erro de conexão com o banco de dados":i.message.includes("timeout")?"Tempo limite excedido":i.message),new Error(`Erro ao salvar briefing institucional: ${e}`)}})),S=e=>c(void 0,null,(function*(){})),E=()=>c(void 0,null,(function*(){try{const{data:e,error:n}=yield u.from("institutional_briefings").select("*").order("created_at",{ascending:!1});if(n)throw new Error(`Erro ao buscar briefings: ${n.message}`);return e||[]}catch(e){throw e}})),O=e=>c(void 0,null,(function*(){try{const{error:n}=yield u.from("institutional_briefings").delete().eq("id",e);if(n)throw new Error(`Erro ao deletar briefing: ${n.message}`)}catch(n){throw n}}));export{w as addProposalValue,h as deleteBriefing,O as deleteInstitutionalBriefing,y as getBriefings,E as getInstitutionalBriefings,_ as submitBriefing,v as submitInstitutionalBriefing,b as updateBriefing};
