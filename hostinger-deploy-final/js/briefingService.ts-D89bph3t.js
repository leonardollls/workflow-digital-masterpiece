var e=Object.defineProperty,r=Object.defineProperties,t=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,a=(r,t,i)=>t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[t]=i,s=(e,r)=>{for(var t in r||(r={}))o.call(r,t)&&a(e,t,r[t]);if(i)for(var t of i(r))n.call(r,t)&&a(e,t,r[t]);return e},c=(e,i)=>r(e,t(i)),l=(e,r,t)=>new Promise(((i,o)=>{var n=e=>{try{s(t.next(e))}catch(r){o(r)}},a=e=>{try{s(t.throw(e))}catch(r){o(r)}},s=e=>e.done?i(e.value):Promise.resolve(e.value).then(n,a);s((t=t.apply(e,r)).next())}));import{s as d,d as g,e as f,g as u}from"../assets/index-lnzsYh22.js";import"./chunk-BFAGzeFF.js";import"./chunk-COwh6yNZ.js";import"./chunk-BU7_rkh7.js";import"./chunk-CTAWNzGL.js";import"./chunk-D1HE5xNQ.js";const m=(e,r,t)=>l(void 0,null,(function*(){if(!e||0===e.length)return[];const i=Array.from(e).map(((e,i)=>l(void 0,null,(function*(){const o=Date.now(),n=`${t}/${o}_${i}_${e.name}`;try{if(e.size>52428800)throw new Error(`Arquivo ${e.name} é muito grande. Máximo 50MB.`);return yield f(e,r,n),u(r,n)}catch(a){throw new Error(`Falha no upload de ${e.name}: ${a instanceof Error?a.message:"Erro desconhecido"}`)}}))));try{return yield Promise.all(i)}catch(o){throw new Error(`Erro no upload de arquivos: ${o instanceof Error?o.message:"Erro desconhecido"}`)}})),p=e=>l(void 0,null,(function*(){try{const[t,i,o]=yield Promise.all([m(e.logoFiles,"briefing-files","logos"),m(e.visualFiles,"briefing-files","visual-references"),m(e.materialFiles,"briefing-files","materials")]),n={company_name:e.companyName||"",business_segment:e.businessSegment||"",company_description:e.businessDescription||"",target_audience:e.targetAudience||"",competitive_advantage:e.competitiveDifferential||"",landing_page_goal:e.landingPageGoal||"",main_competitors:e.mainCompetitors||"",customer_pain_points:e.customerPainPoints||"",success_stories:e.successStories||"",social_proof:e.socialProof||"",responsible_name:e.responsibleName||"",current_website:e.currentWebsite||"",product_name:e.productName||"",product_description:e.productDescription||"",main_benefits:e.mainBenefits||"",number_of_offers:e.numberOfOffers||"",offer_details:e.offerDetails||"",pricing_model:e.pricingModel||"",price_range:e.budget||null,guarantees:e.guarantees||"",target_results:e.targetResults||"",urgency_factors:e.urgencyFactors||"",objections:e.objections||"",call_to_action:e.callToAction||"",lead_destination:e.leadDestination||"",landing_page_sections:e.landingPageSections||"",specific_requirements:e.specificRequirements||"",brand_colors:e.brandColors||"",brand_personality:e.brandPersonality||"",communication_tone:e.communicationTone||"",key_messages:e.keyMessages||"",has_logo:e.hasLogo||"",logo_files:t,visual_references:e.visualReferences||"",visual_files:i,content_materials:e.contentMaterials||"",material_files:o,desired_domain:e.desiredDomain||"",domain_info:e.desiredDomain||"",integrations:e.integrations||"",analytics_tracking:e.analytics||"",deadline:e.deliveryDeadline||"",start_date:e.startDate||"",budget:"Valor Acordado na Workana",additional_notes:e.additionalNotes||""},a=yield((e,r=3,t=1e3)=>l(void 0,null,(function*(){for(let o=1;o<=r;o++)try{return yield e()}catch(i){if(o===r)throw i;yield new Promise((e=>setTimeout(e,t*o)))}throw new Error("Máximo de tentativas excedido")})))((()=>d(n)),3,2e3);try{yield y(a)}catch(r){}return a}catch(t){throw Error,t instanceof Error?t:new Error("Falha ao enviar briefing. Verifique sua conexão e tente novamente.")}})),y=e=>l(void 0,null,(function*(){try{const{data:r,error:t}=yield g.functions.invoke("send-briefing-notification",{body:{briefing:e,to:"contato@workflowdigital.com",subject:`Novo Briefing Recebido - ${e.company_name}`}});return r}catch(r){}})),b=()=>l(void 0,null,(function*(){try{const{data:r,error:t}=yield g.from("client_briefings").select("*").order("created_at",{ascending:!1});if(t){return JSON.parse(localStorage.getItem("briefings")||"[]")}try{localStorage.setItem("briefings",JSON.stringify(r||[]))}catch(e){}return r||[]}catch(r){return JSON.parse(localStorage.getItem("briefings")||"[]")}})),_=(e,r)=>l(void 0,null,(function*(){try{const{data:i,error:o}=yield g.from("client_briefings").select("*").eq("id",e).single();if(o||!i){const t=JSON.parse(localStorage.getItem("briefings")||"[]"),i=t.findIndex((r=>r.id===e));if(-1===i)throw new Error(`Briefing com ID ${e} não encontrado`);return t[i]=c(s(s({},t[i]),r),{updated_at:(new Date).toISOString()}),localStorage.setItem("briefings",JSON.stringify(t)),t[i]}const{data:n,error:a}=yield g.from("client_briefings").update(c(s({},r),{updated_at:(new Date).toISOString()})).eq("id",e).select().single();if(a){const t=JSON.parse(localStorage.getItem("briefings")||"[]"),i=t.findIndex((r=>r.id===e));if(-1!==i)return t[i]=c(s(s({},t[i]),r),{updated_at:(new Date).toISOString()}),localStorage.setItem("briefings",JSON.stringify(t)),t[i];throw new Error("Falha ao atualizar briefing")}try{const r=JSON.parse(localStorage.getItem("briefings")||"[]"),t=r.findIndex((r=>r.id===e));-1!==t&&(r[t]=n,localStorage.setItem("briefings",JSON.stringify(r)))}catch(t){}return n}catch(i){throw i}})),h=e=>l(void 0,null,(function*(){try{const{data:t,error:i}=yield g.from("client_briefings").select("id, company_name").eq("id",e).single();if(i||!t){const r=JSON.parse(localStorage.getItem("briefings")||"[]"),t=r.length,i=r.filter((r=>r.id!==e));if(i.length===t)throw new Error(`Briefing com ID ${e} não encontrado para exclusão`);return void localStorage.setItem("briefings",JSON.stringify(i))}const{error:o,count:n}=yield g.from("client_briefings").delete({count:"exact"}).eq("id",e);if(o)throw new Error(`Erro do Supabase: ${o.message}`);if(0===n)throw new Error("Nenhum registro foi excluído");try{const r=JSON.parse(localStorage.getItem("briefings")||"[]").filter((r=>r.id!==e));localStorage.setItem("briefings",JSON.stringify(r))}catch(r){}}catch(t){try{const r=JSON.parse(localStorage.getItem("briefings")||"[]"),t=r.length,i=r.filter((r=>r.id!==e));if(i.length===t)throw new Error(`Briefing com ID ${e} não encontrado para exclusão`);localStorage.setItem("briefings",JSON.stringify(i))}catch(r){throw new Error("Falha ao excluir briefing")}}})),S=(e,r)=>l(void 0,null,(function*(){try{const t={proposal_value:r,proposal_date:(new Date).toISOString()};return yield _(e,t)}catch(t){throw t}}));export{S as addProposalValue,h as deleteBriefing,b as getBriefings,p as submitBriefing,_ as updateBriefing};
